<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Elastic Stack (formerly ELK) - Logstash (Part 1) &#8212; Markus Zoeller Blog</title>
    
    <link rel="stylesheet" href="../../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/css/asciinema-player.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/asciinema-player.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../../../about/" />
    <link rel="index" title="Index" href="../../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../../search/" />
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
  <link rel="alternate" type="application/atom+xml"  href="../../../../../posts/atom.xml" title="Markus's Brain Swap Space">
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../../">
          MZIO</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../../../about/">About</a></li>
                <li><a href="../../../../category/">Categories</a></li>
                <li><a href="../../../../tag/">Tags</a></li>
                <li><a href="../../../../archive/">Archives</a></li>
                <li><a href="/posts/atom.xml"><i class='fa fa-rss-square' aria-hidden='true'></i></a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../../">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../../search/" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="elastic-stack-formerly-elk-logstash-part-1">
<h1>Elastic Stack (formerly ELK) - <em>Logstash</em> (Part 1)<a class="headerlink" href="#elastic-stack-formerly-elk-logstash-part-1" title="Permalink to this headline"> </a></h1>
<p>In this post I&#8217;ll talk about the <em>Logstash</em> service, which is part of the
<em>Elastic Stack</em>, formerly known as <em>ELK</em> stack. The purpose of <em>Logstash</em> is to
ingest (logging) data, do some transformation or filtering on it,
and output it into a data store like <em>Elasticsearch</em>. For details about <em>Elasticsearch</em>, you
can get more information in my previous post
<a class="reference internal" href="../../../01/05/elastic-stack-elk-elasticsearch/#elastic-stack-elk-elasticsearch"><span class="std std-ref">Elastic Stack (formerly ELK) - Elasticsearch</span></a>.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#intro" id="id12">Intro</a></li>
<li><a class="reference internal" href="#set-up-the-environment" id="id13">Set up the environment</a></li>
<li><a class="reference internal" href="#terms-and-concepts" id="id14">Terms and Concepts</a></li>
<li><a class="reference internal" href="#pipeline-configuration" id="id15">Pipeline Configuration</a></li>
<li><a class="reference internal" href="#basic-interaction-with-ls" id="id16">Basic interaction with <em>Logstash</em></a></li>
<li><a class="reference internal" href="#summary" id="id17">Summary</a></li>
<li><a class="reference internal" href="#references" id="id18">References</a></li>
</ul>
</div>
<table border="1" class="docutils" id="id11">
<caption><span class="caption-text">Change history:</span><a class="headerlink" href="#id11" title="Permalink to this table"> </a></caption>
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Date</th>
<th class="head">Change description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2018-02-16</td>
<td>The first release</td>
</tr>
</tbody>
</table>
<div class="section" id="intro">
<h2><a class="toc-backref" href="#contents">Intro</a><a class="headerlink" href="#intro" title="Permalink to this headline"> </a></h2>
<p>This is the second part of a multi-part series about the
<em>Elastic Stack</em> (formerly known as the <strong>ELK stack</strong>). This stack
consists of 3 parts:</p>
<ul class="simple">
<li><strong>storing data</strong> with <em>Elasticsearch</em></li>
<li><strong>ingesting data</strong> with <em>Logstash</em> (and/or <em>Beats</em>)</li>
<li><strong>visualizing data</strong> with <em>Kibana</em></li>
</ul>
<p>This post will focus on the second part, <em>Logstash</em>.
I&#8217;ll use a <strong>virtualized environment</strong> with only virtual machine,
named <code class="docutils literal"><span class="pre">ls1</span></code>. This virtual machine contains the <em>Logstash</em> service which provides
a REST API at port <code class="docutils literal"><span class="pre">9600</span></code>. But more on that REST API later.</p>
<p>Skip the next section if you don&#8217;t want to repeat the steps locally.</p>
</div>
<div class="section" id="set-up-the-environment">
<h2><a class="toc-backref" href="#contents">Set up the environment</a><a class="headerlink" href="#set-up-the-environment" title="Permalink to this headline"> </a></h2>
<p>To reproduce the steps in this post, you need to have installed locally:</p>
<ul class="simple">
<li><em>Vagrant</em> <a class="footnote-reference" href="#vagrinst" id="id1">[1]</a></li>
<li><em>Ansible</em> <a class="footnote-reference" href="#ansinst" id="id2">[2]</a></li>
<li><em>VirtualBox</em> <a class="footnote-reference" href="#vbinst" id="id3">[3]</a></li>
</ul>
<p>After these <strong>prerequisites</strong> are fulfilled:</p>
<ol class="arabic simple">
<li>download the compressed
<a class="reference download internal" href="../../../../../_downloads/elastic-stack-elk-logstash-part1.tar.gz" download=""><code class="xref download docutils literal"><span class="pre">project</span> <span class="pre">source</span> <span class="pre">files</span></code></a>.</li>
<li>extract the archive</li>
<li>change to the <code class="docutils literal"><span class="pre">env</span></code> directory</li>
<li>start the <em>Vagrant</em> setup</li>
</ol>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ wget http://www.markusz.io/_downloads/elastic-stack-elk-logstash-part1.tar.gz
$ tar -zxvf elastic-stack-elk-logstash-part1.tar.gz
$ <span class="nb">cd</span> env
$ vagrant up  <span class="c1"># does also all of the installation</span>
</pre></div>
</td></tr></table></div>
<p>After this is fully done, you can access these two servers with:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ vagrant ssh         <span class="c1"># log into the logstash server</span>
<span class="o">[</span>vagrant@ls1<span class="o">]</span> $ <span class="nb">exit</span>  <span class="c1"># log out</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">After you decided that you don&#8217;t need this environment anymore,
you can remove it with <code class="docutils literal"><span class="pre">vagrant</span> <span class="pre">destroy</span> <span class="pre">-f</span></code></p>
</div>
<p>While the setup goes on for a minute or two, let&#8217;s have a look at
a few basic terms and concepts of <em>Logstash</em>.</p>
</div>
<div class="section" id="terms-and-concepts">
<h2><a class="toc-backref" href="#contents">Terms and Concepts</a><a class="headerlink" href="#terms-and-concepts" title="Permalink to this headline"> </a></h2>
<p><em>Logstash</em> has a concept of <strong>pipelines</strong>. It reads data from a source, optionally
transforms and/or filters out the data and writes the data to a data sink.
The pipelines are configured with these three steps</p>
<ol class="arabic simple">
<li>the <code class="docutils literal"><span class="pre">input</span></code> step</li>
<li>the <code class="docutils literal"><span class="pre">filter</span></code> step</li>
<li>the <code class="docutils literal"><span class="pre">output</span></code> step</li>
</ol>
<a class="reference internal image-reference" href="../../../../../_images/logstash_pipeline_1TcRt4t.svg"><img alt="The pipeline concept of |ls|" src="../../../../../_images/logstash_pipeline_1TcRt4t.svg" width="900px" /></a>
<p>This allows to have <strong>multiple pipelines</strong> in parallel, or let the output
from one pipelines be the input for another pipeline. It&#8217;s the very same
idea like in a shell.</p>
<p>Every atomic input such a pipeline can read is called an <strong>event</strong>.
The <code class="docutils literal"><span class="pre">filter</span></code> step can transform such events to a different format
or even filter out some events. This makes <em>Logstash</em> very flexible and you
can adjust it to your data.</p>
<p>The steps described above are implemented as <em>plugins</em>. There are many
input plugins <a class="footnote-reference" href="#lsin" id="id4">[4]</a>, filter plugins <a class="footnote-reference" href="#lsfil" id="id5">[5]</a> and output
plugins <a class="footnote-reference" href="#lsout" id="id6">[6]</a>. Let&#8217;s see in the next section what we can do
with these plugins and how to specify a pipeline.</p>
</div>
<div class="section" id="pipeline-configuration">
<h2><a class="toc-backref" href="#contents">Pipeline Configuration</a><a class="headerlink" href="#pipeline-configuration" title="Permalink to this headline"> </a></h2>
<p>The pipelines get configured with a custom grammar which resembles <em>Ruby</em>
a little, but it isn&#8217;t. The description of the syntax is at <a class="footnote-reference" href="#config" id="id7">[7]</a>.
For our first pipeline, create a file
<code class="docutils literal"><span class="pre">/etc/logstash/conf.d/logstash-simple.conf</span></code> with this content:</p>
<div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span>input {
  file {
    id =&gt; &quot;my-app1-id-in&quot;
    path =&gt; &quot;/var/log/app1/source.log&quot;
  }
}

output {
  file {
    id =&gt; &quot;my-app1-id-out&quot;
    path =&gt; &quot;/var/log/app1/target.log&quot;
  }
}
</pre></div>
</td></tr></table></div>
<p>This file gets read because <em>Logstash</em> uses the often seen <code class="docutils literal"><span class="pre">conf.d</span></code>
concept:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ cat /etc/logstash/pipelines.yml
<span class="c1"># This file is where you define your pipelines. You can define multiple.</span>
<span class="c1"># For more information on multiple pipelines, see the documentation:</span>
<span class="c1">#   https://www.elastic.co/guide/en/logstash/current/multiple-pipelines.html</span>

<span class="hll">- pipeline.id: main
</span>  path.config: <span class="s2">&quot;/etc/logstash/conf.d/*.conf&quot;</span>
</pre></div>
</td></tr></table></div>
<p>This example is rather useless in a real-live setup, but shows well the
structure and how to use one of the many input and output plugins.
I deliberately left out the (optional) filter plugin, to keep the
example simple.</p>
<p>What&#8217;s happening here is:</p>
<ul class="simple">
<li>we use the <code class="docutils literal"><span class="pre">file</span></code> input plugin <a class="footnote-reference" href="#filein" id="id8">[8]</a></li>
<li>we gave that one usage of that plugin the ID <code class="docutils literal"><span class="pre">my-app1-id-in</span></code></li>
<li>we specified that this input plugin should listen on changes for
file <code class="docutils literal"><span class="pre">/var/log/app1/source.log</span></code></li>
<li>we configured the <code class="docutils literal"><span class="pre">file</span></code> output plugin similarly <a class="footnote-reference" href="#fileout" id="id9">[9]</a></li>
</ul>
<p>Let&#8217;s use this pipeline with some dummy data:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ vagrant ssh
$ <span class="nb">echo</span> <span class="k">$(</span>date -Is<span class="k">)</span> &gt;&gt; /var/log/app1/source.log
</pre></div>
</td></tr></table></div>
<p>Execute this last line a few times and take a look at what the <em>Logstash</em>
pipeline has output into the target file.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The <code class="docutils literal"><span class="pre">jq</span></code> CLI is very useful to show that JSON output.</p>
</div>
<p>Execute <code class="docutils literal"><span class="pre">cat</span> <span class="pre">/var/log/app1/target.log</span> <span class="pre">|</span> <span class="pre">jq</span></code>:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;@version&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-14T18:24:19+00:00&quot;</span><span class="p">,</span>
  <span class="nt">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-14T18:24:21.364Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/log/app1/source.log&quot;</span><span class="p">,</span>
  <span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;ls1&quot;</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&quot;@version&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-14T18:24:33+00:00&quot;</span><span class="p">,</span>
  <span class="nt">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-14T18:24:34.414Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/log/app1/source.log&quot;</span><span class="p">,</span>
  <span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;ls1&quot;</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&quot;@version&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-14T18:24:36+00:00&quot;</span><span class="p">,</span>
  <span class="nt">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-14T18:24:37.491Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/log/app1/source.log&quot;</span><span class="p">,</span>
  <span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;ls1&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>As a comparison, this is our source file:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ cat /var/log/app1/source.log
<span class="m">2018</span>-02-14T18:24:19+00:00
<span class="m">2018</span>-02-14T18:24:33+00:00
<span class="m">2018</span>-02-14T18:24:36+00:00
</pre></div>
</td></tr></table></div>
<p>A few interesting observations with this small example:</p>
<ul class="simple">
<li><em>Logstash</em> encapsulates the message we created into a JSON object and adds
meta data like a timestamp, the host and the version</li>
<li>there is a small delay between our message creation and the
timestamp which <em>Logstash</em> adds itself</li>
</ul>
<p>When working with those pipelines and events, it may become useful
to get some insights into <em>Logstash</em> itself. The next section will show how
to get them.</p>
</div>
<div class="section" id="basic-interaction-with-ls">
<h2><a class="toc-backref" href="#contents">Basic interaction with <em>Logstash</em></a><a class="headerlink" href="#basic-interaction-with-ls" title="Permalink to this headline"> </a></h2>
<p>As shown in the beginning, <em>Logstash</em> has a REST API to get some stats
from it. This is useful to get some insights, for example if your
configured pipelines are recognized and how many events they processed.</p>
<p>For this, <em>Logstash</em> needs to bind to an IP address you can reach from outside
the server. In my virtual environment, I have this setting
in the file <code class="docutils literal"><span class="pre">/etc/logstash/logstash.yml</span></code>:</p>
<div class="highlight-yml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span># ------------ Metrics Settings --------------
# Bind address for the metrics REST endpoint
http.host: &quot;192.168.73.12&quot;
</pre></div>
</td></tr></table></div>
<p>To make the following queries a bit easier to read, export the URI of
the <em>Logstash</em> server as variable.</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">ls1</span><span class="o">=</span><span class="s2">&quot;http://192.168.73.12:9600&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Let&#8217;s do some queries.</p>
<p><strong>Request details about the Logstash instance:</strong></p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ curl <span class="s2">&quot;</span><span class="nv">$ls1</span><span class="s2">/?pretty&quot;</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">During my experiments, the REST API didn&#8217;t come up if not
at least one pipeline was defined. Not sure if this is a bug
or a feature. The next section will tell more about pipeline
definitions.</p>
</div>
<p>Response:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.2.1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;http_address&quot;</span> <span class="p">:</span> <span class="s2">&quot;192.168.73.12:9600&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;b961f021-8470-48ad-ba6c-a4f1ca4ca5f1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;build_date&quot;</span> <span class="p">:</span> <span class="s2">&quot;2018-02-07T21:17:29+00:00&quot;</span><span class="p">,</span>
  <span class="nt">&quot;build_sha&quot;</span> <span class="p">:</span> <span class="s2">&quot;2b141ed331d8372b0cdd01fd1caad330ecc77df6&quot;</span><span class="p">,</span>
  <span class="nt">&quot;build_snapshot&quot;</span> <span class="p">:</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>You&#8217;ll notice that we&#8217;re on host <code class="docutils literal"><span class="pre">ls1</span></code> as described in the environment
section from the beginning of this post, and that we use <em>Logstash</em> in version
<code class="docutils literal"><span class="pre">6.2</span></code>. This request helps to figure out if the instance is running.</p>
<p><strong>Request details about the pipelines:</strong></p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ curl <span class="s2">&quot;</span><span class="nv">$ls1</span><span class="s2">/_node/pipelines?pretty&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Response:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.2.1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;http_address&quot;</span> <span class="p">:</span> <span class="s2">&quot;192.168.73.12:9600&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;b961f021-8470-48ad-ba6c-a4f1ca4ca5f1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;pipelines&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="hll">    <span class="nt">&quot;main&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span>      <span class="nt">&quot;workers&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="nt">&quot;batch_size&quot;</span> <span class="p">:</span> <span class="mi">125</span><span class="p">,</span>
      <span class="nt">&quot;batch_delay&quot;</span> <span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
      <span class="nt">&quot;config_reload_automatic&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nt">&quot;config_reload_interval&quot;</span> <span class="p">:</span> <span class="mi">3000000000</span><span class="p">,</span>
      <span class="nt">&quot;dead_letter_queue_enabled&quot;</span> <span class="p">:</span> <span class="kc">false</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>There is one pipeline configured, named <code class="docutils literal"><span class="pre">main</span></code>. The configuration
was shown in the previous section. To be honest, I have no clue yet
what the other key-value-pairs in that dictionary mean. My assumption
is, that in high-availability setups, these things get important,
but ignore them for now.</p>
<p><strong>Request metrics about the events:</strong></p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ curl <span class="s2">&quot;</span><span class="nv">$ls1</span><span class="s2">/_node/stats/events?pretty&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Response:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.2.1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;http_address&quot;</span> <span class="p">:</span> <span class="s2">&quot;192.168.73.12:9600&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;b961f021-8470-48ad-ba6c-a4f1ca4ca5f1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;events&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="hll">    <span class="nt">&quot;in&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span class="hll">    <span class="nt">&quot;filtered&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span class="hll">    <span class="nt">&quot;out&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span>    <span class="nt">&quot;duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">99</span><span class="p">,</span>
    <span class="nt">&quot;queue_push_duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This shows well how the processing of <em>Logstash</em> is based on <em>events</em>.
Also, the pipeline steps from above can be found here. The three
events I created above are reflected here too.</p>
<p><strong>Request metrics about the pipeline named</strong> <code class="docutils literal"><span class="pre">main</span></code>:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ curl <span class="s2">&quot;</span><span class="nv">$ls1</span><span class="s2">/_node/stats/pipelines/main?pretty&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Response:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.2.1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;http_address&quot;</span> <span class="p">:</span> <span class="s2">&quot;192.168.73.12:9600&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;b961f021-8470-48ad-ba6c-a4f1ca4ca5f1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;pipelines&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;main&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;events&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">99</span><span class="p">,</span>
        <span class="nt">&quot;in&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="nt">&quot;out&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="nt">&quot;filtered&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="nt">&quot;queue_push_duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="nt">&quot;plugins&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;inputs&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
<span class="hll">          <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;my-app1-id-in&quot;</span><span class="p">,</span>
</span>          <span class="nt">&quot;events&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;out&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="nt">&quot;queue_push_duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">0</span>
          <span class="p">},</span>
<span class="hll">          <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;file&quot;</span>
</span>        <span class="p">}</span> <span class="p">],</span>
        <span class="nt">&quot;filters&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">],</span>
        <span class="nt">&quot;outputs&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
<span class="hll">          <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;my-app1-id-out&quot;</span><span class="p">,</span>
</span>          <span class="nt">&quot;events&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">93</span><span class="p">,</span>
            <span class="nt">&quot;in&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="nt">&quot;out&quot;</span> <span class="p">:</span> <span class="mi">3</span>
          <span class="p">},</span>
<span class="hll">          <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;file&quot;</span>
</span>        <span class="p">}</span> <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&quot;reloads&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;last_error&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nt">&quot;successes&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;last_success_timestamp&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nt">&quot;last_failure_timestamp&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nt">&quot;failures&quot;</span> <span class="p">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="nt">&quot;queue&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;memory&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This shows the IDs we specified earlier and what type of plugin for
input and output we used. The next section will use a filter plugin
and show some of the capabilities.</p>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#contents">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline"> </a></h2>
<p>To keep this post at an digestible size, I make a cut here and will focus
in a follow up post more on the filter plugins and more realistic input
and how to connect to <em>Elasticsearch</em> as a data store.</p>
<p>This post showed a brief overview of the basics, which is simply necessary
to dive deeper into the great possibilities <em>Logstash</em> offers. We&#8217;ve seen
the pipeline concept and that events get encapsulated into JSON objects.
The metrics REST API of <em>Logstash</em> provides observability.</p>
<p>One thing I didn&#8217;t talk about, but you should be aware of when you
consider to use <em>Logstash</em> in a productive environment, is the fact that there
are <em>in-memory queues</em> and <em>persistent queues</em> and you need to make a
decision what fits your requirements best <a class="footnote-reference" href="#queue" id="id10">[10]</a>. Unfortunately I have
too little real-live knowledge to give a recommendation here.</p>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#contents">References</a><a class="headerlink" href="#references" title="Permalink to this headline"> </a></h2>
<table class="docutils footnote" frame="void" id="vagrinst" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://www.vagrantup.com/docs/installation/">https://www.vagrantup.com/docs/installation/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="ansinst" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://docs.ansible.com/ansible/latest/intro_installation.html">http://docs.ansible.com/ansible/latest/intro_installation.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="vbinst" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="lsin" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="https://www.elastic.co/guide/en/logstash/6.2/input-plugins.html">https://www.elastic.co/guide/en/logstash/6.2/input-plugins.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="lsfil" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="https://www.elastic.co/guide/en/logstash/6.2/filter-plugins.html">https://www.elastic.co/guide/en/logstash/6.2/filter-plugins.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="lsout" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td><a class="reference external" href="https://www.elastic.co/guide/en/logstash/6.2/output-plugins.html">https://www.elastic.co/guide/en/logstash/6.2/output-plugins.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="config" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[7]</a></td><td><a class="reference external" href="https://www.elastic.co/guide/en/logstash/6.2/configuration-file-structure.html">https://www.elastic.co/guide/en/logstash/6.2/configuration-file-structure.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="filein" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[8]</a></td><td><a class="reference external" href="https://www.elastic.co/guide/en/logstash/6.2/plugins-inputs-file.html">https://www.elastic.co/guide/en/logstash/6.2/plugins-inputs-file.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fileout" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[9]</a></td><td><a class="reference external" href="https://www.elastic.co/guide/en/logstash/6.2/plugins-outputs-file.html">https://www.elastic.co/guide/en/logstash/6.2/plugins-outputs-file.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="queue" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[10]</a></td><td><a class="reference external" href="https://www.elastic.co/guide/en/logstash/6.2/persistent-queues.html">https://www.elastic.co/guide/en/logstash/6.2/persistent-queues.html</a></td></tr>
</tbody>
</table>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  Previous: 
  <a href="../../02/project-docs-rst-markup-sphinx/">
    
    Project documentation with reStructuredText and Sphinx
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'mzio';
        var disqus_identifier = '/posts/2018/02/16/elastic-stack-elk-logstash-part1/';
        var disqus_title = 'Elastic Stack (formerly ELK) - &lt;em&gt;Logstash&lt;/em&gt; (Part 1)';
        var disqus_url = 'http://www.markusz.io/posts/2018/02/16/elastic-stack-elk-logstash-part1/';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015-2018, Markus Zoeller.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>