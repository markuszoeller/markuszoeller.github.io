<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Elastic Stack (formerly ELK) - Logstash &#8212; Markus Zoeller Blog</title>
    
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/asciinema-player.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/js/asciinema-player.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../about/" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
  <link rel="alternate" type="application/atom+xml"  href="../../../posts/atom.xml" title="Markus's Brain Swap Space">
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../">
          MZIO</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../about/">About</a></li>
                <li><a href="../../category/">Categories</a></li>
                <li><a href="../../tag/">Tags</a></li>
                <li><a href="../../archive/">Archives</a></li>
                <li><a href="/posts/atom.xml"><i class='fa fa-rss-square' aria-hidden='true'></i></a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search/" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="elastic-stack-formerly-elk-logstash">
<h1>Elastic Stack (formerly ELK) - <em>Logstash</em><a class="headerlink" href="#elastic-stack-formerly-elk-logstash" title="Permalink to this headline"> </a></h1>
<p>abstract</p>
<p>Some notes:</p>
<ul class="simple">
<li>Logging as a Service with <em>Elastic</em> Cloud Enterprise</li>
<li>data flow pipelines (pipe to pipe to pipe)</li>
<li>independent pipelines in one <em>Logstash</em> instance</li>
<li>&#8220;beats&#8221; protocol</li>
<li>&#8220;event&#8221; is the primary unit which gets sent to <em>Logstash</em></li>
<li>&#8220;workers&#8221; scale out the processing</li>
<li>in-memory queue vs. persistent queue</li>
<li>&#8220;at least once&#8221; delivery (err on the side of duplication)</li>
<li>codecs serialize and deserialize</li>
<li><code class="docutils literal"><span class="pre">json_lines</span></code> codecs is available  # non-human</li>
<li><code class="docutils literal"><span class="pre">dissect</span></code> is the &#8220;smaller version&#8221; of <code class="docutils literal"><span class="pre">grok</span></code> (delimiter vs regex)</li>
<li><em>kibana</em> can monitor <em>Logstash</em> and <em>Elasticsearch</em>  # not sure</li>
<li><em>Logstash</em> has an external REST API for metrics</li>
</ul>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#intro" id="id5">Intro</a></li>
<li><a class="reference internal" href="#set-up-the-environment" id="id6">Set up the environment</a></li>
<li><a class="reference internal" href="#terms-and-concepts" id="id7">Terms and Concepts</a></li>
<li><a class="reference internal" href="#basic-interaction-with-ls" id="id8">Basic interaction with <em>Logstash</em></a></li>
<li><a class="reference internal" href="#first-pipeline" id="id9">First Pipeline</a></li>
<li><a class="reference internal" href="#a-pipeline-with-a-filter" id="id10">A Pipeline with a Filter</a></li>
<li><a class="reference internal" href="#brain-dump" id="id11">Brain Dump</a><ul>
<li><a class="reference internal" href="#pipeline-config" id="id12">pipeline config</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary" id="id13">Summary</a></li>
<li><a class="reference internal" href="#references" id="id14">References</a></li>
</ul>
</div>
<table border="1" class="docutils" id="id4">
<caption><span class="caption-text">Change history:</span><a class="headerlink" href="#id4" title="Permalink to this table"> </a></caption>
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Date</th>
<th class="head">Change description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>TODO</td>
<td>The first release</td>
</tr>
</tbody>
</table>
<div class="section" id="intro">
<h2><a class="toc-backref" href="#contents">Intro</a><a class="headerlink" href="#intro" title="Permalink to this headline"> </a></h2>
<p>This is the second part of a multi-part series about the
<em>Elastic Stack</em> (formerly known as the <strong>ELK stack</strong>). This stack
consists of 3 parts:</p>
<ul class="simple">
<li><strong>storing data</strong> with <em>Elasticsearch</em></li>
<li><strong>ingesting data</strong> with <em>Logstash</em> (and/or <em>Beats</em>)</li>
<li><strong>visualizing data</strong> with <em>Kibana</em></li>
</ul>
<p>This post will focus on the second part, <em>Logstash</em>. <em>Logstash</em> uses <em>Elasticsearch</em> as
storage back-end in this post, so you might want to read the previous
post about it at <a class="reference internal" href="../../2018/01/05/elastic-stack-elk-elasticsearch/#elastic-stack-elk-elasticsearch"><span class="std std-ref">Elastic Stack (formerly ELK) - Elasticsearch</span></a>.</p>
<p>I&#8217;ll use a <strong>virtualized environment</strong> which looks like this:</p>
<a class="reference internal image-reference" href="../../../_images/environment_overview_Plniuva.svg"><img alt="The environment of virtual machines I used in this post." src="../../../_images/environment_overview_Plniuva.svg" width="600px" /></a>
<ul class="simple">
<li>Server <code class="docutils literal"><span class="pre">es1</span></code> contains the <em>Elasticsearch</em> service which provides a REST API
at port <code class="docutils literal"><span class="pre">9200</span></code>.</li>
<li>Server <code class="docutils literal"><span class="pre">ls1</span></code> contains the <em>Logstash</em> service which provides a REST API
at port <code class="docutils literal"><span class="pre">9600</span></code>. The <em>Logstash</em> service will use the REST API of <em>Elasticsearch</em>
to store the logs.</li>
</ul>
<p>Skip the next section if you don&#8217;t want to repeat the steps locally.</p>
</div>
<div class="section" id="set-up-the-environment">
<h2><a class="toc-backref" href="#contents">Set up the environment</a><a class="headerlink" href="#set-up-the-environment" title="Permalink to this headline"> </a></h2>
<p>To reproduce the steps in this post, you need to have installed locally:</p>
<ul class="simple">
<li><em>Vagrant</em> <a class="footnote-reference" href="#vagrinst" id="id1">[1]</a></li>
<li><em>Ansible</em> <a class="footnote-reference" href="#ansinst" id="id2">[2]</a></li>
<li><em>VirtualBox</em> <a class="footnote-reference" href="#vbinst" id="id3">[3]</a></li>
</ul>
<p>After these <strong>prerequisites</strong> are fulfilled:</p>
<ol class="arabic simple">
<li>download the compressed
<a class="reference download internal" href="../../../_downloads/elastic-stack-elk-logstash.tar.gz" download=""><code class="xref download docutils literal"><span class="pre">project</span> <span class="pre">source</span> <span class="pre">files</span></code></a>.</li>
<li>extract the archive</li>
<li>change to the <code class="docutils literal"><span class="pre">env</span></code> directory</li>
<li>start the <em>Vagrant</em> setup</li>
</ol>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ wget http://www.markusz.io/_downloads/elastic-stack-elk-logstash.tar.gz
$ tar -zxvf elastic-stack-elk-logstash.tar.gz
$ <span class="nb">cd</span> env
$ vagrant up  <span class="c1"># does also all of the installation</span>
</pre></div>
</td></tr></table></div>
<p>After this is fully done, you can access these two servers with:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ vagrant ssh es1     <span class="c1"># log into the elasticsearch server</span>
<span class="o">[</span>vagrant@es1<span class="o">]</span> $ <span class="nb">exit</span>  <span class="c1"># log out</span>
$ vagrant ssh ls1     <span class="c1"># log into the logstash server</span>
<span class="o">[</span>vagrant@ls1<span class="o">]</span> $ <span class="nb">exit</span>  <span class="c1"># log out</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">After you decided that you don&#8217;t need this environment anymore,
you can remove it with <code class="docutils literal"><span class="pre">vagrant</span> <span class="pre">destroy</span> <span class="pre">-f</span></code></p>
</div>
<p>While the setup goes on for a minute or two, let&#8217;s have a look at
a few basic terms and concepts of <em>Logstash</em>.</p>
</div>
<div class="section" id="terms-and-concepts">
<h2><a class="toc-backref" href="#contents">Terms and Concepts</a><a class="headerlink" href="#terms-and-concepts" title="Permalink to this headline"> </a></h2>
<p><em>Logstash</em> has a concept of <strong>pipelines</strong>. It reads data from a source, optionally
transforms and/or filters out the data and writes the data to a data sink.
The pipelines are configured with these three steps</p>
<ol class="arabic simple">
<li>the <code class="docutils literal"><span class="pre">input</span></code></li>
<li>the <code class="docutils literal"><span class="pre">filter</span></code></li>
<li>the <code class="docutils literal"><span class="pre">output</span></code></li>
</ol>
<a class="reference internal image-reference" href="../../../_images/logstash_pipeline_1TcRt4t.svg"><img alt="The pipeline concept of |ls|" src="../../../_images/logstash_pipeline_1TcRt4t.svg" width="900px" /></a>
<p>This allows to have <strong>multiple pipelines</strong> in parallel, or let the output
from one pipelines be the input for another pipeline. It&#8217;s the very same
idea like in a shell.</p>
<p>Every atomic input such a pipeline can read is called an <strong>event</strong>.
The <code class="docutils literal"><span class="pre">filter</span></code> step can transform such events to a different format
or even filter out some events. This makes <em>Logstash</em> very flexible and you
can adjust it to your data.</p>
</div>
<div class="section" id="basic-interaction-with-ls">
<h2><a class="toc-backref" href="#contents">Basic interaction with <em>Logstash</em></a><a class="headerlink" href="#basic-interaction-with-ls" title="Permalink to this headline"> </a></h2>
<p>As shown in the beginning, <em>Logstash</em> has a REST API to get some stats
from it. <em>Logstash</em> needs to bind to an IP address you can reach from
outside the server. In my virtual environment, I have this setting
in the file <code class="docutils literal"><span class="pre">/etc/logstash/logstash.yml</span></code>:</p>
<div class="highlight-yml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span># ------------ Metrics Settings --------------
# Bind address for the metrics REST endpoint
http.host: &quot;192.168.73.12&quot;
</pre></div>
</td></tr></table></div>
<p>To make the following queries a bit easier to read, export the URI:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">ls1</span><span class="o">=</span><span class="s2">&quot;http://192.168.73.12:9600&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Let&#8217;s do some queries:</p>
<ol class="arabic">
<li><p class="first">Details about the <em>Logstash</em> instance:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ curl <span class="s2">&quot;</span><span class="nv">$ls1</span><span class="s2">/?pretty&quot;</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">During my experiments, the REST API didn&#8217;t come up if not
at least one pipeline was defined. Not sure if this is a bug
or a feature. The next section will tell more about pipeline
definitions.</p>
</div>
<p>Response:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.2.1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;http_address&quot;</span> <span class="p">:</span> <span class="s2">&quot;192.168.73.12:9600&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;b961f021-8470-48ad-ba6c-a4f1ca4ca5f1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;build_date&quot;</span> <span class="p">:</span> <span class="s2">&quot;2018-02-07T21:17:29+00:00&quot;</span><span class="p">,</span>
  <span class="nt">&quot;build_sha&quot;</span> <span class="p">:</span> <span class="s2">&quot;2b141ed331d8372b0cdd01fd1caad330ecc77df6&quot;</span><span class="p">,</span>
  <span class="nt">&quot;build_snapshot&quot;</span> <span class="p">:</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Details about the pipelines:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ curl <span class="s2">&quot;</span><span class="nv">$ls1</span><span class="s2">/_node/pipelines?pretty&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Response:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.2.1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;http_address&quot;</span> <span class="p">:</span> <span class="s2">&quot;192.168.73.12:9600&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;b961f021-8470-48ad-ba6c-a4f1ca4ca5f1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;pipelines&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="hll">    <span class="nt">&quot;main&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span>      <span class="nt">&quot;workers&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="nt">&quot;batch_size&quot;</span> <span class="p">:</span> <span class="mi">125</span><span class="p">,</span>
      <span class="nt">&quot;batch_delay&quot;</span> <span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
      <span class="nt">&quot;config_reload_automatic&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nt">&quot;config_reload_interval&quot;</span> <span class="p">:</span> <span class="mi">3000000000</span><span class="p">,</span>
      <span class="nt">&quot;dead_letter_queue_enabled&quot;</span> <span class="p">:</span> <span class="kc">false</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Metrics about the events:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ curl <span class="s2">&quot;</span><span class="nv">$ls1</span><span class="s2">/_node/stats/events?pretty&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Response:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.2.1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;http_address&quot;</span> <span class="p">:</span> <span class="s2">&quot;192.168.73.12:9600&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;b961f021-8470-48ad-ba6c-a4f1ca4ca5f1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;events&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="hll">    <span class="nt">&quot;in&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class="hll">    <span class="nt">&quot;filtered&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class="hll">    <span class="nt">&quot;out&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span>    <span class="nt">&quot;duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;queue_push_duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Metrics about the pipeline named <em>main</em>:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ curl <span class="s2">&quot;</span><span class="nv">$ls1</span><span class="s2">/_node/stats/pipelines/main?pretty&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Response:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span> <span class="p">:</span> <span class="s2">&quot;6.2.1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;http_address&quot;</span> <span class="p">:</span> <span class="s2">&quot;192.168.73.12:9600&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;b961f021-8470-48ad-ba6c-a4f1ca4ca5f1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;ls1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;pipelines&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;main&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;events&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;in&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;out&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;filtered&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;queue_push_duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="nt">&quot;plugins&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;inputs&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
          <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;my-app1-id-in&quot;</span><span class="p">,</span>
          <span class="nt">&quot;events&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;out&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;queue_push_duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">0</span>
          <span class="p">},</span>
          <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;file&quot;</span>
        <span class="p">}</span> <span class="p">],</span>
        <span class="nt">&quot;filters&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">],</span>
        <span class="nt">&quot;outputs&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
          <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;my-app1-id-out&quot;</span><span class="p">,</span>
          <span class="nt">&quot;events&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;duration_in_millis&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;in&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;out&quot;</span> <span class="p">:</span> <span class="mi">0</span>
          <span class="p">},</span>
          <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;file&quot;</span>
        <span class="p">}</span> <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&quot;reloads&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;last_error&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nt">&quot;successes&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;last_success_timestamp&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nt">&quot;last_failure_timestamp&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nt">&quot;failures&quot;</span> <span class="p">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="nt">&quot;queue&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;memory&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ol>
</div>
<div class="section" id="first-pipeline">
<h2><a class="toc-backref" href="#contents">First Pipeline</a><a class="headerlink" href="#first-pipeline" title="Permalink to this headline"> </a></h2>
<div class="highlight-ruby"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1"># cat /etc/logstash/conf.d/logstash-simple.conf</span>
 <span class="n">input</span> <span class="p">{</span>
   <span class="n">file</span> <span class="p">{</span>
     <span class="nb">id</span> <span class="o">=&gt;</span> <span class="s2">&quot;my-app1-id-in&quot;</span>
     <span class="n">path</span> <span class="o">=&gt;</span> <span class="s2">&quot;/var/log/app1/source.log&quot;</span>
   <span class="p">}</span>
 <span class="p">}</span>

 <span class="n">output</span> <span class="p">{</span>
   <span class="n">file</span> <span class="p">{</span>
     <span class="nb">id</span> <span class="o">=&gt;</span> <span class="s2">&quot;my-app1-id-out&quot;</span>
     <span class="n">path</span> <span class="o">=&gt;</span> <span class="s2">&quot;/var/log/app1/target.log&quot;</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="a-pipeline-with-a-filter">
<h2><a class="toc-backref" href="#contents">A Pipeline with a Filter</a><a class="headerlink" href="#a-pipeline-with-a-filter" title="Permalink to this headline"> </a></h2>
<p>TODO</p>
</div>
<div class="section" id="brain-dump">
<h2><a class="toc-backref" href="#contents">Brain Dump</a><a class="headerlink" href="#brain-dump" title="Permalink to this headline"> </a></h2>
<p><em>Bash</em> history:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="m">27</span>  vm /etc/logstash/conf.d/stdio.conf /etc/logstash/conf.d/logstash-simple.conf
<span class="m">28</span>  mv /etc/logstash/conf.d/stdio.conf /etc/logstash/conf.d/logstash-simple.conf
<span class="m">29</span>  vim /etc/logstash/conf.d/logstash-simple.conf
<span class="m">30</span>  systemctl restart logstash.service
<span class="m">31</span>  vim /etc/logstash/pipelines.yml
<span class="m">33</span>  systemctl status logstash.service
<span class="m">34</span>  vim /var/log/logstash/logstash-plain.log
<span class="m">35</span>  curl localhost:9600
<span class="m">36</span>  tail -f /var/log/logstash/logstash-plain.log
<span class="m">37</span>  <span class="nb">echo</span> <span class="s2">&quot;foo&quot;</span>
<span class="m">38</span>  vim /etc/logstash/conf.d/logstash-simple.conf
<span class="m">39</span>  mkdir -p /var/log/app1
<span class="m">40</span>  <span class="nb">echo</span> <span class="k">$(</span>date -Is<span class="k">)</span> &gt;&gt; /var/log/app1/source.log
<span class="m">41</span>  cat /var/log/app1/source.log
<span class="m">42</span>  cat /var/log/app1/target.log
<span class="m">43</span>  systemctl restart logstash.service
<span class="m">44</span>  <span class="nb">echo</span> <span class="k">$(</span>date -Is<span class="k">)</span> &gt;&gt; /var/log/app1/source.log
<span class="m">45</span>  cat /var/log/app1/source.log
<span class="m">46</span>  cat /var/log/app1/target.log
<span class="m">47</span>  tail -f /var/log/logstash/logstash-plain.log
<span class="m">48</span>  cat /var/log/app1/target.log
<span class="m">49</span>  touch /var/log/app1/target.log
<span class="m">50</span>  <span class="nb">echo</span> <span class="k">$(</span>date -Is<span class="k">)</span> &gt;&gt; /var/log/app1/source.log
<span class="m">51</span>  cat /var/log/app1/target.log
<span class="m">52</span>  vim /etc/logstash/conf.d/logstash-simple.conf
<span class="m">53</span>  systemctl restart logstash.service
<span class="m">54</span>  curl -XGET <span class="s1">&#39;localhost:9600/_node/pipelines?pretty&#39;</span>
<span class="m">55</span>  curl -XGET <span class="s1">&#39;localhost:9600/_node/pipelines/main?pretty&#39;</span>
<span class="m">56</span>  curl -XGET <span class="s1">&#39;localhost:9600/_node/jvm?pretty&#39;</span>
<span class="m">57</span>  curl -XGET <span class="s1">&#39;localhost:9600/_node/plugins?pretty&#39;</span>
<span class="m">58</span>  curl -XGET <span class="s1">&#39;localhost:9600/_node/stats/process?pretty&#39;</span>
<span class="m">59</span>  curl -XGET <span class="s1">&#39;localhost:9600/_node/stats/events?pretty&#39;</span>
<span class="m">60</span>  curl -XGET <span class="s1">&#39;localhost:9600/_node/stats/pipelines?pretty&#39;</span>
<span class="m">61</span>  curl -XGET <span class="s1">&#39;localhost:9600/_node/stats/pipelines/main?pretty&#39;</span>
<span class="m">62</span>  <span class="nb">echo</span> <span class="k">$(</span>date -Is<span class="k">)</span> &gt;&gt; /var/log/app1/source.log
<span class="m">63</span>  curl -XGET <span class="s1">&#39;localhost:9600/_node/stats/pipelines/main?pretty&#39;</span>
<span class="m">64</span>  <span class="nb">echo</span> <span class="k">$(</span>date -Is<span class="k">)</span> &gt;&gt; /var/log/app1/source.log
<span class="m">65</span>  cat /var/log/app1/target.log
<span class="m">66</span>  ll /var/log/app1/target.log
<span class="m">67</span>  ll /var/log/logstash/
<span class="m">68</span>  chown -R logstash:logstash /var/log/app1/
<span class="m">69</span>  ll /var/log/app1/
<span class="m">70</span>  <span class="nb">echo</span> <span class="k">$(</span>date -Is<span class="k">)</span> &gt;&gt; /var/log/app1/source.log
<span class="m">71</span>  cat /var/log/app1/target.log
<span class="m">72</span>  cat /var/log/app1/source.log
<span class="m">73</span>  cat /var/log/app1/target.log
<span class="m">74</span>  tail -f /var/log/app1/target.log
<span class="m">75</span>  cat /var/log/app1/target.log
<span class="m">76</span>  <span class="nb">history</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="pipeline-config">
<h3><a class="toc-backref" href="#contents">pipeline config</a><a class="headerlink" href="#pipeline-config" title="Permalink to this headline"> </a></h3>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>root@ls1:~# ll /var/log/app1/
total <span class="m">16</span>
drwxr-xr-x <span class="m">2</span> logstash logstash <span class="m">4096</span> Feb  <span class="m">9</span> <span class="m">14</span>:27 ./
drwxrwxr-x <span class="m">9</span> root     syslog   <span class="m">4096</span> Feb  <span class="m">9</span> <span class="m">14</span>:24 ../
-rw-r--r-- <span class="m">1</span> logstash logstash  <span class="m">434</span> Feb  <span class="m">9</span> <span class="m">14</span>:54 source.log
-rw-r--r-- <span class="m">1</span> logstash logstash  <span class="m">844</span> Feb  <span class="m">9</span> <span class="m">14</span>:54 target.log
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#contents">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline"> </a></h2>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">TODO</p>
</div>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#contents">References</a><a class="headerlink" href="#references" title="Permalink to this headline"> </a></h2>
<table class="docutils footnote" frame="void" id="vagrinst" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://www.vagrantup.com/docs/installation/">https://www.vagrantup.com/docs/installation/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="ansinst" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://docs.ansible.com/ansible/latest/intro_installation.html">http://docs.ansible.com/ansible/latest/intro_installation.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="vbinst" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="concepts" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/_basic_concepts.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.1/_basic_concepts.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="lucene" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td><a class="reference external" href="https://lucene.apache.org/">https://lucene.apache.org/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="commonapi" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/common-options.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.1/common-options.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="yamllist" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[7]</td><td><a class="reference external" href="http://www.yaml.org/spec/1.2/spec.html#id2797382">http://www.yaml.org/spec/1.2/spec.html#id2797382</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="esversion" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/docs-index_.html#index-versioning">https://www.elastic.co/guide/en/elasticsearch/reference/6.1/docs-index_.html#index-versioning</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="esindexdis" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[9]</td><td><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/docs-index_.html#index-creation">https://www.elastic.co/guide/en/elasticsearch/reference/6.1/docs-index_.html#index-creation</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="esindexcreate" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[10]</td><td><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/indices-create-index.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.1/indices-create-index.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="flask" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[11]</td><td><a class="reference external" href="http://flask.pocoo.org/">http://flask.pocoo.org/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="pylog" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[12]</td><td><a class="reference external" href="https://docs.python.org/2/howto/logging.html#logging-basic-tutorial">https://docs.python.org/2/howto/logging.html#logging-basic-tutorial</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="pylogrot" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[13]</td><td><a class="reference external" href="https://docs.python.org/2/library/logging.handlers.html#logging.handlers.RotatingFileHandler">https://docs.python.org/2/library/logging.handlers.html#logging.handlers.RotatingFileHandler</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="essearch" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[14]</td><td><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/search.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="rsyslog" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[15]</td><td><a class="reference external" href="http://www.rsyslog.com/">http://www.rsyslog.com/</a></td></tr>
</tbody>
</table>
</div>
</div>

  <div class="section">
  
    


  
  
  </div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015-2018, Markus Zoeller.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>