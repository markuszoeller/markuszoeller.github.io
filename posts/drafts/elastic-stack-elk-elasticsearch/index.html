<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Elastic Stack (formerly ELK) - Elasticsearch &#8212; Markus Zoeller Blog</title>
    
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/asciinema-player.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/js/asciinema-player.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../about/" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
  <link rel="alternate" type="application/atom+xml"  href="../../../posts/atom.xml" title="Markus's Brain Swap Space">
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../">
          MZIO</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../about/">About</a></li>
                <li><a href="../../category/">Categories</a></li>
                <li><a href="../../tag/">Tags</a></li>
                <li><a href="../../archive/">Archives</a></li>
                <li><a href="/posts/atom.xml"><i class='fa fa-rss-square' aria-hidden='true'></i></a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search/" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="elastic-stack-formerly-elk-elasticsearch">
<h1>Elastic Stack (formerly ELK) - <em>Elasticsearch</em><a class="headerlink" href="#elastic-stack-formerly-elk-elasticsearch" title="Permalink to this headline"> </a></h1>
<p>Each post should start with one paragraph which is an abstract of the post.
This paragraph should be enough for a reader to decide if they want to
read the post or not. It is best to keep this paragraph short and simple.
100 words or less is the limit, as this abstract is used as excerpt in the
list on the landing page and in the feed readers. This upper limit
of 100 words is also the amount of content someone should be able to read
in less than 20 seconds. Additionally, it fits on one small mobile screen.</p>
<p><a class="reference external" href="https://www.elastic.co/webinars/getting-started-elasticsearch?elektra=ELKvideo">https://www.elastic.co/webinars/getting-started-elasticsearch?elektra=ELKvideo</a></p>
<p>Maybe use <a class="reference external" href="http://jsonlines.org/on_the_web/">http://jsonlines.org/on_the_web/</a> for the example logs</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#intro" id="id8">Intro</a></li>
<li><a class="reference internal" href="#set-up-the-environment" id="id9">Set up the environment</a></li>
<li><a class="reference internal" href="#terms-and-concepts" id="id10">Terms and Concepts</a></li>
<li><a class="reference internal" href="#basic-interaction-with-es" id="id11">Basic Interaction with <em>Elasticsearch</em></a></li>
<li><a class="reference internal" href="#logging-to-es" id="id12">Logging to <em>Elasticsearch</em></a></li>
<li><a class="reference internal" href="#basic-crudl-operations" id="id13">Basic CRUDL operations</a></li>
<li><a class="reference internal" href="#conclusion" id="id14">Conclusion</a><ul>
<li><a class="reference internal" href="#questions" id="id15">questions</a></li>
<li><a class="reference internal" href="#terms" id="id16">Terms:</a></li>
<li><a class="reference internal" href="#actions" id="id17">Actions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references" id="id18">References</a></li>
</ul>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">date of the change history</p>
</div>
<table border="1" class="docutils" id="id7">
<caption><span class="caption-text">Change history:</span><a class="headerlink" href="#id7" title="Permalink to this table"> </a></caption>
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Date</th>
<th class="head">Change description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2017-11-02</td>
<td>The first release</td>
</tr>
</tbody>
</table>
<div class="section" id="intro">
<h2><a class="toc-backref" href="#contents">Intro</a><a class="headerlink" href="#intro" title="Permalink to this headline"> </a></h2>
<p>This is the first part of a multi-part series about the
<em>Elastic Stack</em> (formerly the <strong>ELK stack</strong>). This stack
consists of 3 parts:</p>
<ul class="simple">
<li><strong>storing data</strong> with <em>Elasticsearch</em></li>
<li><strong>ingesting data</strong> with <em>Logstash</em> (and/or <em>Beats</em>)</li>
<li><strong>visualizing data</strong> with <em>Kibana</em></li>
</ul>
<p>This post will focus on the first part, <em>Elasticsearch</em>.</p>
<p>It uses a schema-less, flexible data model, which means you
can use your current data as-is and don&#8217;t have to transform
it into another schema so that <em>Elasticsearch</em> can deal with it.</p>
<p>This post will focus on the <em>log analytics</em> part and
won&#8217;t delve into metrics analytics or other use cases.</p>
<p>We will also not talk about the <em>x-pack</em> plugins,
which would add more functionality.</p>
<p>The platform support matrix is at:
<a class="reference external" href="https://www.elastic.co/support/matrix">https://www.elastic.co/support/matrix</a></p>
</div>
<div class="section" id="set-up-the-environment">
<h2><a class="toc-backref" href="#contents">Set up the environment</a><a class="headerlink" href="#set-up-the-environment" title="Permalink to this headline"> </a></h2>
<p>To reproduce the steps in this post, you need to have installed locally:</p>
<ul class="simple">
<li><em>Vagrant</em> <a class="footnote-reference" href="#vagrinst" id="id1">[1]</a></li>
<li><em>Ansible</em> <a class="footnote-reference" href="#ansinst" id="id2">[2]</a></li>
<li><em>VirtualBox</em> <a class="footnote-reference" href="#vbinst" id="id3">[3]</a></li>
</ul>
<p>After these prerequisites are fulfilled:</p>
<ol class="arabic simple">
<li>download the compressed
<a class="reference download internal" href="../../../_downloads/elastic-stack-elk-elasticsearch.tar.gz" download=""><code class="xref download docutils literal"><span class="pre">project</span> <span class="pre">source</span> <span class="pre">files</span></code></a>.</li>
<li>extract the archive</li>
<li>change to the <code class="docutils literal"><span class="pre">env</span></code> directory</li>
<li>start the <em>Vagrant</em> setup</li>
<li>use <em>Ansible</em> to configure the environment</li>
</ol>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ wget http://www.markusz.io/_downloads/elastic-stack-elk-elasticsearch.tar.gz
$ tar -zxvf elastic-stack-elk-elasticsearch.tar.gz
$ <span class="nb">cd</span> env
$ vagrant up
$ ansible-playbook playbook.yml
</pre></div>
</td></tr></table></div>
<p>Your (truncated) output should look similar to this:</p>
<div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span>[...]

PLAY RECAP ********************************************************************
app1                       : ok=10   changed=6    unreachable=0    failed=0
app2                       : ok=10   changed=6    unreachable=0    failed=0
es1                        : ok=21   changed=17   unreachable=0    failed=0

Thursday 04 January 2018  16:29:04 +0100 (0:00:01.319)       0:02:06.741 ******
===============================================================================
Install python package manager. ---------------------------------------- 50.79s
Install JAVA runtime. -------------------------------------------------- 24.73s
Check if Elasticsearch is up an running. ------------------------------- 11.50s
Wait for SSH to be ready. ---------------------------------------------- 10.36s
Download file with checksum check. -------------------------------------- 9.31s
Install app requirements. ----------------------------------------------- 4.87s
Ensure system package cache is updated. --------------------------------- 4.46s
Unarchive the elasticsearch archive. ------------------------------------ 1.43s
Run example app. -------------------------------------------------------- 1.32s
Run elasticsearch as daemon. -------------------------------------------- 1.22s
Add our servers to the hosts file. -------------------------------------- 0.99s
Deploy example app to servers. ------------------------------------------ 0.88s
Ping each other via DNS names. ------------------------------------------ 0.77s
Gather some facts for later. -------------------------------------------- 0.62s
Creating user for Elasticsearch group. ---------------------------------- 0.37s
Create a group for Elasticsearch. --------------------------------------- 0.32s
Disable all swapping. --------------------------------------------------- 0.32s
Create logging directory. ----------------------------------------------- 0.31s
Set maximum number of memory map areas (permanently). ------------------- 0.29s
Set number of open file descriptors (permanently). ---------------------- 0.28s
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">After you decided that you don&#8217;t need this environment anymore,
you can remove it with <code class="docutils literal"><span class="pre">vagrant</span> <span class="pre">destroy</span> <span class="pre">-f</span></code></p>
</div>
<p>This created an environment which looks like this:</p>
<a class="reference internal image-reference" href="../../../_images/elasticsearch-env-nF4AMyX.svg"><img alt="*Vagrant* environment with virtual machines." src="../../../_images/elasticsearch-env-nF4AMyX.svg" /></a>
<ul class="simple">
<li>one central logging server <code class="docutils literal"><span class="pre">es1</span></code></li>
<li>two application servers <code class="docutils literal"><span class="pre">app1</span></code> and <code class="docutils literal"><span class="pre">app2</span></code></li>
<li><em>Ubuntu 16.04</em> as operating system</li>
<li>Java <em>Open JDK</em> in version 8</li>
<li><em>Elasticsearch</em> in version 6.1</li>
</ul>
<p>While the setup goes on for a minute or two, let&#8217;s have a look at
a few basic terms and concepts of <em>Elasticsearch</em>.</p>
</div>
<div class="section" id="terms-and-concepts">
<h2><a class="toc-backref" href="#contents">Terms and Concepts</a><a class="headerlink" href="#terms-and-concepts" title="Permalink to this headline"> </a></h2>
<p>Let&#8217;s start with an overview of the basic concepts <a class="footnote-reference" href="#concepts" id="id4">[4]</a>.
I&#8217;ll explain the details after this image:</p>
<a class="reference internal image-reference" href="../../../_images/elasticsearch-concepts-YfYunTY.svg"><img alt="The basic terms and concepts in |es|" src="../../../_images/elasticsearch-concepts-YfYunTY.svg" /></a>
<p>The main entity we&#8217;re interested in is the <strong>Document</strong>. This is the
schema-less entity we want to store in <em>Elasticsearch</em>. In our case, as this post
focuses on centralized logging, this is one single log entry.</p>
<p><em>Elasticsearch</em> stores <em>Documents</em> in an <strong>Index</strong> and every <em>Index</em> can store multiple
<em>Documents</em>. The <em>Index</em> is the entity which provides the ability to search
<em>Document</em> objects.</p>
<p>Each <em>Elasticsearch</em> service is considered a <strong>Node</strong>. This <em>Node</em> is not necessarily
bound to one hardware server or virtual machine. Each <em>Node</em> is in other
words, an <em>Elasticsearch</em> instance. Each one can have 0 to N <em>Index</em> objects to
scale out the management of <em>Document</em> objects.</p>
<p>For further horizontal scale out, each <em>Node</em> can be part of a <strong>Cluster</strong>.
Each <em>Cluster</em> consists of 1 to N <em>Node</em> objects. A single-node setup is
still a <em>Cluster</em> (with only 1 <em>Node</em>). There are <em>master nodes</em> in a
cluster, which determine how information gets replicated, but I won&#8217;t
dive into it in this post.</p>
<p>As described before, an <em>Index</em> is the (abstract) entity which stores
our documents. To be precise, an <em>Index</em> consists of <strong>Shards</strong>. These
<em>Shard</em> objects are <em>Index</em> objects themselves and can therefore store
<em>Documents</em>. This concept enables splitting out the <em>Documents</em> into
smaller segments. One <em>Shard</em> is in fact the <em>Lucene Index</em> <a class="footnote-reference" href="#lucene" id="id5">[5]</a>,
the search engine encapsulated by <em>Elasticsearch</em>. Such <em>shards</em> can be called
<strong>primary shards</strong>.</p>
<p>The <em>Shard</em> objects can be replicated (copied) into so called <strong>Replica</strong>
entities (or <strong>replica shards</strong>). A set of <em>Replica</em> objects are collected
in a <strong>Replication Group</strong>. Those <em>replica shards</em> enable
<em>High Availability (HA)</em> and <em>Data Recovery (DR)</em>. Hopefully I can
dive deeper into these capabilities in a later post.</p>
<p>After these basic terms and concepts are described, let&#8217;s finally
interact with <em>Elasticsearch</em> in our environment.</p>
</div>
<div class="section" id="basic-interaction-with-es">
<h2><a class="toc-backref" href="#contents">Basic Interaction with <em>Elasticsearch</em></a><a class="headerlink" href="#basic-interaction-with-es" title="Permalink to this headline"> </a></h2>
<p>After the setup by the <em>Ansible playbook</em>, we can interact with <em>Elasticsearch</em>
via <code class="docutils literal"><span class="pre">curl</span></code> on our local machine:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span>markus@local<span class="o">]</span>$ curl <span class="m">192</span>.168.78.11:9200
<span class="o">{</span>
  <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;hMDFApt&quot;</span>,
  <span class="s2">&quot;cluster_name&quot;</span> : <span class="s2">&quot;elasticsearch&quot;</span>,
  <span class="s2">&quot;cluster_uuid&quot;</span> : <span class="s2">&quot;kEM4Oz-PQQ-98ZgdOxGOdw&quot;</span>,
  <span class="s2">&quot;version&quot;</span> : <span class="o">{</span>
    <span class="s2">&quot;number&quot;</span> : <span class="s2">&quot;6.1.1&quot;</span>,
    <span class="s2">&quot;build_hash&quot;</span> : <span class="s2">&quot;bd92e7f&quot;</span>,
    <span class="s2">&quot;build_date&quot;</span> : <span class="s2">&quot;2017-12-17T20:23:25.338Z&quot;</span>,
    <span class="s2">&quot;build_snapshot&quot;</span> : false,
    <span class="s2">&quot;lucene_version&quot;</span> : <span class="s2">&quot;7.1.0&quot;</span>,
    <span class="s2">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="s2">&quot;5.6.0&quot;</span>,
    <span class="s2">&quot;minimum_index_compatibility_version&quot;</span> : <span class="s2">&quot;5.0.0&quot;</span>
  <span class="o">}</span>,
  <span class="s2">&quot;tagline&quot;</span> : <span class="s2">&quot;You Know, for Search&quot;</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>We use <code class="docutils literal"><span class="pre">format=yaml</span></code>, one of the common REST API options of <em>Elasticsearch</em>
<a class="footnote-reference" href="#commonapi" id="id6">[6]</a>, to have an output which is easier to read.</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span>markus@local<span class="o">]</span>$ curl <span class="m">192</span>.168.78.11:9200/_cat/health?format<span class="o">=</span>yaml
---
- epoch: <span class="s2">&quot;1514998054&quot;</span>
  timestamp: <span class="s2">&quot;16:47:34&quot;</span>
  cluster: <span class="s2">&quot;elasticsearch&quot;</span>
  status: <span class="s2">&quot;green&quot;</span>
  node.total: <span class="s2">&quot;1&quot;</span>
  node.data: <span class="s2">&quot;1&quot;</span>
  shards: <span class="s2">&quot;0&quot;</span>
  pri: <span class="s2">&quot;0&quot;</span>
  relo: <span class="s2">&quot;0&quot;</span>
  init: <span class="s2">&quot;0&quot;</span>
  unassign: <span class="s2">&quot;0&quot;</span>
  pending_tasks: <span class="s2">&quot;0&quot;</span>
  max_task_wait_time: <span class="s2">&quot;-&quot;</span>
  active_shards_percent: <span class="s2">&quot;100.0%&quot;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span>markus@local<span class="o">]</span>$ curl <span class="m">192</span>.168.78.11:9200/_cat/nodes?format<span class="o">=</span>yaml
---
- ip: <span class="s2">&quot;192.168.78.11&quot;</span>
  heap.percent: <span class="s2">&quot;6&quot;</span>
  ram.percent: <span class="s2">&quot;63&quot;</span>
  cpu: <span class="s2">&quot;0&quot;</span>
  load_1m: <span class="s2">&quot;0.00&quot;</span>
  load_5m: <span class="s2">&quot;0.00&quot;</span>
  load_15m: <span class="s2">&quot;0.00&quot;</span>
  node.role: <span class="s2">&quot;mdi&quot;</span>
  master: <span class="s2">&quot;*&quot;</span>
  name: <span class="s2">&quot;hMDFApt&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Useful common options:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">pretty=true</span></code> to beautify the JSON output</li>
<li><code class="docutils literal"><span class="pre">format=yaml</span></code> as we used before</li>
<li><code class="docutils literal"><span class="pre">error_trace=true</span></code> to show a more verbose error trace</li>
<li><code class="docutils literal"><span class="pre">filter_path=&lt;values&gt;</span></code> to reduce the response</li>
</ul>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span> curl -XPUT <span class="s1">&#39;192.168.78.11:9200/twitter/tweet/1?pretty&#39;</span> <span class="se">\</span>
 -H <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\</span>
 -d <span class="s1">&#39;{</span>
<span class="s1">     &quot;user&quot; : &quot;kimchy&quot;,</span>
<span class="s1">     &quot;post_date&quot; : &quot;2009-11-15T14:12:12&quot;,</span>
<span class="s1">     &quot;message&quot; : &quot;trying out Elasticsearch&quot;</span>
<span class="s1"> }&#39;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span> $ curl -X GET <span class="m">192</span>.168.78.11:9200/_cat/indices?format<span class="o">=</span>yaml
 ---
 - health: <span class="s2">&quot;yellow&quot;</span>
   status: <span class="s2">&quot;open&quot;</span>
   index: <span class="s2">&quot;app&quot;</span>
   uuid: <span class="s2">&quot;EgTSMR4AQpKfSXRh3r6Rqw&quot;</span>
   pri: <span class="s2">&quot;5&quot;</span>
   rep: <span class="s2">&quot;1&quot;</span>
   docs.count: <span class="s2">&quot;3&quot;</span>
   docs.deleted: <span class="s2">&quot;0&quot;</span>
   store.size: <span class="s2">&quot;16.1kb&quot;</span>
   pri.store.size: <span class="s2">&quot;16.1kb&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="logging-to-es">
<h2><a class="toc-backref" href="#contents">Logging to <em>Elasticsearch</em></a><a class="headerlink" href="#logging-to-es" title="Permalink to this headline"> </a></h2>
<p>Custom logger</p>
</div>
<div class="section" id="basic-crudl-operations">
<h2><a class="toc-backref" href="#contents">Basic CRUDL operations</a><a class="headerlink" href="#basic-crudl-operations" title="Permalink to this headline"> </a></h2>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="o">[</span>markus@local<span class="o">]</span>$ curl -X GET <span class="m">192</span>.168.78.11:9200/app/_search?pretty<span class="o">=</span><span class="nb">true</span>
 <span class="o">{</span>
   <span class="s2">&quot;took&quot;</span> : <span class="m">1</span>,
   <span class="s2">&quot;timed_out&quot;</span> : false,
   <span class="s2">&quot;_shards&quot;</span> : <span class="o">{</span>
     <span class="s2">&quot;total&quot;</span> : <span class="m">5</span>,
     <span class="s2">&quot;successful&quot;</span> : <span class="m">5</span>,
     <span class="s2">&quot;skipped&quot;</span> : <span class="m">0</span>,
     <span class="s2">&quot;failed&quot;</span> : <span class="m">0</span>
   <span class="o">}</span>,
   <span class="s2">&quot;hits&quot;</span> : <span class="o">{</span>
     <span class="s2">&quot;total&quot;</span> : <span class="m">3</span>,
     <span class="s2">&quot;max_score&quot;</span> : <span class="m">1</span>.0,
     <span class="s2">&quot;hits&quot;</span> : <span class="o">[</span>
       <span class="o">{</span>
         <span class="s2">&quot;_index&quot;</span> : <span class="s2">&quot;app&quot;</span>,
         <span class="s2">&quot;_type&quot;</span> : <span class="s2">&quot;logs&quot;</span>,
         <span class="s2">&quot;_id&quot;</span> : <span class="s2">&quot;KpBcvWAB78EA2Ko2WrB2&quot;</span>,
         <span class="s2">&quot;_score&quot;</span> : <span class="m">1</span>.0,
         <span class="s2">&quot;_source&quot;</span> : <span class="o">{</span>
           <span class="s2">&quot;timestamp&quot;</span> : <span class="s2">&quot;foo&quot;</span>,
           <span class="s2">&quot;message&quot;</span> : <span class="s2">&quot;bar&quot;</span>,
           <span class="s2">&quot;module&quot;</span> : <span class="s2">&quot;app&quot;</span>,
           <span class="s2">&quot;level&quot;</span> : <span class="s2">&quot;INFO&quot;</span>
         <span class="o">}</span>
       <span class="o">}</span>,
       <span class="o">{</span>
         <span class="s2">&quot;_index&quot;</span> : <span class="s2">&quot;app&quot;</span>,
         <span class="s2">&quot;_type&quot;</span> : <span class="s2">&quot;logs&quot;</span>,
         <span class="s2">&quot;_id&quot;</span> : <span class="s2">&quot;K5BgvWAB78EA2Ko2Q7B-&quot;</span>,
         <span class="s2">&quot;_score&quot;</span> : <span class="m">1</span>.0,
         <span class="s2">&quot;_source&quot;</span> : <span class="o">{</span>
           <span class="s2">&quot;timestamp&quot;</span> : <span class="s2">&quot;foo&quot;</span>,
           <span class="s2">&quot;message&quot;</span> : <span class="s2">&quot;info message&quot;</span>,
           <span class="s2">&quot;module&quot;</span> : <span class="s2">&quot;app&quot;</span>,
           <span class="s2">&quot;level&quot;</span> : <span class="s2">&quot;INFO&quot;</span>
         <span class="o">}</span>
       <span class="o">}</span>,
       <span class="o">{</span>
         <span class="s2">&quot;_index&quot;</span> : <span class="s2">&quot;app&quot;</span>,
         <span class="s2">&quot;_type&quot;</span> : <span class="s2">&quot;logs&quot;</span>,
         <span class="s2">&quot;_id&quot;</span> : <span class="s2">&quot;LJBhvWAB78EA2Ko2k7Dy&quot;</span>,
         <span class="s2">&quot;_score&quot;</span> : <span class="m">1</span>.0,
         <span class="s2">&quot;_source&quot;</span> : <span class="o">{</span>
           <span class="s2">&quot;timestamp&quot;</span> : <span class="s2">&quot;foo&quot;</span>,
           <span class="s2">&quot;message&quot;</span> : <span class="s2">&quot;info message&quot;</span>,
           <span class="s2">&quot;module&quot;</span> : <span class="s2">&quot;app&quot;</span>,
           <span class="s2">&quot;level&quot;</span> : <span class="s2">&quot;INFO&quot;</span>
         <span class="o">}</span>
       <span class="o">}</span>
     <span class="o">]</span>
   <span class="o">}</span>
 <span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#contents">Conclusion</a><a class="headerlink" href="#conclusion" title="Permalink to this headline"> </a></h2>
<p>Logging to the HTTP address itself doesn&#8217;t make sense. We will
use <em>Logstash</em> in the next post which does that for us.</p>
<div class="section" id="questions">
<h3><a class="toc-backref" href="#contents">questions</a><a class="headerlink" href="#questions" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li>Q: Horizontal scale out of <em>Elasticsearch</em> instances?</li>
</ul>
</div>
<div class="section" id="terms">
<h3><a class="toc-backref" href="#contents">Terms:</a><a class="headerlink" href="#terms" title="Permalink to this headline"> </a></h3>
<dl class="docutils">
<dt>document</dt>
<dd>One single, unstructured entry in <em>Elasticsearch</em> which gets
tokenized into its parts.</dd>
</dl>
</div>
<div class="section" id="actions">
<h3><a class="toc-backref" href="#contents">Actions</a><a class="headerlink" href="#actions" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">match</span></code> (<code class="docutils literal"><span class="pre">OR</span></code>&#8216;ed; see <code class="docutils literal"><span class="pre">_score</span></code>)</li>
<li><code class="docutils literal"><span class="pre">match_phrase</span></code></li>
<li><code class="docutils literal"><span class="pre">must</span></code> and <code class="docutils literal"><span class="pre">must_not</span></code></li>
<li><code class="docutils literal"><span class="pre">AND</span></code>&#8216;ed with multiple <em>clauses</em></li>
<li><code class="docutils literal"><span class="pre">should</span></code> orders by score</li>
<li>querying and filtering are different</li>
<li>understand the <em>analysis</em> for tokenized documents</li>
<li>aggregations with <code class="docutils literal"><span class="pre">aggs</span></code> (and e.g. <code class="docutils literal"><span class="pre">avg</span></code>)</li>
<li>partial update with  <code class="docutils literal"><span class="pre">POST</span></code> to <code class="docutils literal"><span class="pre">_update</span></code> API</li>
<li>replacement with plain <code class="docutils literal"><span class="pre">POST</span></code> API on index</li>
</ul>
</div>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#contents">References</a><a class="headerlink" href="#references" title="Permalink to this headline"> </a></h2>
<table class="docutils footnote" frame="void" id="vagrinst" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://www.vagrantup.com/docs/installation/">https://www.vagrantup.com/docs/installation/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="ansinst" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://docs.ansible.com/ansible/latest/intro_installation.html">http://docs.ansible.com/ansible/latest/intro_installation.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="vbinst" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="concepts" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/_basic_concepts.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.1/_basic_concepts.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="lucene" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="https://lucene.apache.org/">https://lucene.apache.org/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="commonapi" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/common-options.html#common-options">https://www.elastic.co/guide/en/elasticsearch/reference/6.1/common-options.html#common-options</a></td></tr>
</tbody>
</table>
</div>
</div>

  <div class="section">
  
    


  
  
  </div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015-2017, Markus Zoeller.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>